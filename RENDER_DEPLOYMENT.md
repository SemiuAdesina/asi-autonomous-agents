# Render Deployment Guide for ASI Autonomous Agents

## Overview
This guide provides step-by-step instructions for deploying the ASI Autonomous Agents platform to Render using the free tier with a proper PostgreSQL database setup.

## Services Architecture

### 1. PostgreSQL Database (asi-database)
- **Type**: Web Service (Docker)
- **Runtime**: Docker
- **Plan**: Free
- **Image**: PostgreSQL 15 Alpine
- **Database Name**: `asi_agents`
- **Database User**: `asi_user`
- **Connection**: `postgresql://asi_user:changeme@asi-database:5432/asi_agents`

### 2. Backend Service (asi-backend)
- **Type**: Web Service
- **Runtime**: Python
- **Plan**: Free
- **Port**: 5001 (default)
- **Health Check**: `/health`
- **Database**: Connected to `asi-database`

### 3. Frontend Service (asi-frontend)
- **Type**: Static Site
- **Runtime**: Next.js
- **Plan**: Free
- **Build**: `npm run build`

### 4. MeTTa Server (asi-metta-server)
- **Type**: Web Service
- **Runtime**: Python FastAPI
- **Plan**: Free
- **Port**: 8000

### 5. Healthcare Agent (asi-healthcare-agent)
- **Type**: Background Worker
- **Runtime**: Python
- **Plan**: Free
- **Port**: 8001

### 6. Financial Agent (asi-financial-agent)
- **Type**: Background Worker
- **Runtime**: Python
- **Plan**: Free
- **Port**: 8003

### 7. Logistics Agent (asi-logistics-agent)
- **Type**: Background Worker
- **Runtime**: Python
- **Plan**: Free
- **Port**: 8002

## Database Setup

### PostgreSQL Free Tier Benefits
- **Storage**: 1GB (sufficient for development)
- **Connections**: Up to 20 concurrent connections
- **Backup**: Automatic daily backups
- **SSL**: Encrypted connections
- **No Sleep**: Database stays active 24/7

### Database Configuration
The database is automatically configured with:
- **Database Name**: `asi_agents`
- **Username**: `asi_user`
- **Password**: Auto-generated by Render
- **Connection String**: Automatically injected as `DATABASE_URL`

## Deployment Steps

### Step 1: Prepare Repository
1. Ensure all code is committed to GitHub
2. Verify `render.yaml` is in the root directory
3. Check that all `requirements.txt` files exist
4. Ensure database migrations are ready

### Step 2: Create Render Account
1. Go to [render.com](https://render.com)
2. Sign up with GitHub
3. Connect your repository

### Step 3: Deploy Services
1. Click "New" â†’ "Blueprint"
2. Select your repository
3. Render will automatically detect `render.yaml`
4. Review and deploy all services (including database)

### Step 4: Database Migration
After deployment, run database migrations:
1. Go to your backend service dashboard
2. Click "Shell" to open a terminal
3. Run: `cd backend && python -c "from app import db; db.create_all()"`

### Step 5: Configure Environment Variables
After deployment, configure these environment variables in Render dashboard:

#### Backend Service
- `ASI_ONE_API_KEY`: Your ASI:One API key
- `SECRET_KEY`: Auto-generated
- `JWT_SECRET_KEY`: Auto-generated
- `DATABASE_URL`: Auto-injected from database service

#### Agent Services
- `ASI_ONE_API_KEY`: Your ASI:One API key (same for all agents)

### Step 6: Update Frontend Configuration
The frontend will automatically use the deployed backend URLs:
- `NEXT_PUBLIC_BACKEND_URL`: `https://asi-backend.onrender.com`
- `NEXT_PUBLIC_API_URL`: `https://asi-backend.onrender.com/api`

## Free Tier Limitations

### PostgreSQL Database
- **Storage**: 1GB
- **Connections**: 20 concurrent
- **Backup**: 7 days retention
- **No Sleep**: Always available

### Web Services
- **Sleep**: Services sleep after 15 minutes of inactivity
- **Cold Start**: 30-60 seconds wake-up time
- **Bandwidth**: 100GB/month
- **Build Time**: 90 minutes/month

### Background Workers
- **Sleep**: Workers sleep after 15 minutes of inactivity
- **CPU**: 0.1 CPU
- **Memory**: 512MB RAM

### Static Sites
- **Bandwidth**: 100GB/month
- **Build Time**: 90 minutes/month

## Database Connection Details

### Automatic Connection
The `DATABASE_URL` environment variable is automatically set by Render and contains:
```
postgresql://asi_user:password@hostname:port/asi_agents
```

### Manual Connection (if needed)
If you need to connect manually:
1. Go to your database service dashboard
2. Click "Connect" tab
3. Use the provided connection details

## Monitoring and Maintenance

### Health Checks
- Backend: `https://asi-backend.onrender.com/health`
- MeTTa Server: `https://asi-metta-server.onrender.com/health`
- Database: Automatically monitored by Render

### Logs
- Access logs through Render dashboard
- Monitor for errors and performance issues
- Database logs available in database service dashboard

### Scaling
- Free tier is sufficient for development and testing
- Upgrade to paid plans for production use
- Database can be upgraded independently

## Troubleshooting

### Common Issues
1. **Service Sleep**: Services sleep after inactivity - first request may be slow
2. **Build Failures**: Check `requirements.txt` and build commands
3. **Database Connection**: Ensure database service is running
4. **Environment Variables**: Ensure all required variables are set
5. **Port Conflicts**: Each service uses different ports

### Database Issues
1. **Connection Errors**: Check if database service is running
2. **Migration Errors**: Run migrations manually via shell
3. **Permission Errors**: Verify database user permissions

### Debugging
1. Check Render logs for errors
2. Verify environment variables
3. Test database connection via shell
4. Test endpoints individually
5. Check service dependencies

## Cost Optimization
- Use free tier for development
- Monitor usage to avoid overages
- Consider upgrading only essential services
- Use static site for frontend (cheaper than web service)
- Database stays free with 1GB storage

## Security Considerations
- Use environment variables for secrets
- Enable HTTPS (automatic on Render)
- Database connections are SSL encrypted
- Regular security updates
- Monitor access logs
- Database backups are automatic
